pekko {
  http {
    client {
      parsing {
        max-content-length="100g"
      }
    }
    host-connection-pool {
      max-open-requests=128
      response-entity-subscription-timeout="15.seconds"
    }
  }
}
app {
  http {
    base-uri = "http://delta:8080/v1"
    interface = 0.0.0.0
  }

  database {
    tables-autocreate = true

    partition-strategy {
      type = ${PARTITION_STRATEGY}
      modulo = 1
    }

    read = ${app.defaults.database.access} {
      pool-size = 10
    }
    write = ${app.defaults.database.access} {
      pool-size = 10
    }
    streaming = ${app.defaults.database.access} {
      pool-size = 10
    }
  }

  elem-query {
    type = "passivation"
    batch-size = 30
    delay = 200 millis
  }

  project-last-update {
    batch {
      # the maximum batching size, corresponding to the maximum number of elements being aggregated
      # at the same time before pushing the update.
      max-elements = 100
      # the maximum batching duration.
      max-interval = 100 millis
    }
    query {
      batch-size = 30
      refresh-strategy = 100 millis
    }
    inactive-interval = 5 seconds
  }

  projections {
    batch {
      max-elements = 30
      # the maximum batching duration.
      max-interval = 1 second
    }
  }

  defaults {
    database {
      access {
        host = "postgres"
      }
    }

    query {
      refresh-strategy = 250 millis
    }
  }

  resources {
    schema-enforcement {
      type-whitelist = ["http://schema.org/Chapter", "http://schema.org/Book"]
      allow-no-types = true
    }
  }

  service-account {
    subject: "service-account-delta"
    realm: "internal"
  }

  projects {
    deletion {
      enabled = true
      propagation-delay = 3 seconds
    }
  }

  elasticsearch {
    base = "http://elasticsearch:9200"
    credentials {
      username = "elastic"
      password = "password"
    }

    otel {
      capture-queries = false
    }

    batch {
      max-elements = 5
      max-interval = 50 millis
    }
  }
}

plugins {

  blazegraph {
    access {
      endpoints = [ "http://blazegraph:9999/blazegraph" ]
    }

    batch {
      max-elements = 5
      max-interval = 50 millis
    }
  }

  composite-views {
    min-interval-rebuild = 5 seconds
    sink-config = batch
    remote-source-credentials {
      type: "client-credentials"
      user: "delta"
      password: "shhh"
      realm: "internal"
    }
  }

  storage {
    storages {
      disk {
        default-volume= "/default-volume"
      }

      amazon {
        enabled = true
        default-endpoint = "http://s3.localhost.localstack.cloud:4566"
        default-access-key = "MY_ACCESS_KEY"
        default-secret-key = "CHUTCHUT"
        default-bucket = "mydefaultbucket"
        prefix = "/myprefix"
      }
    }

    files {
      media-type-detector {
        extensions {
          custom = "application/custom"
        }
      }
    }
  }

  project-deletion {
    enabled = true
    included-projects = [
      "autodeletion.+"
    ]
    excluded-projects = []
    idle-interval = 5s
    idle-check-period = 1s
    delete-deprecated-projects = true
  }
}